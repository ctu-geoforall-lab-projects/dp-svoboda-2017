\chapter{Podklady}
\label{podklady}

\section{VFK}
\label{vfk}

Nejdůležitějším podkladem pro~zásuvný modul vytvořený v~rámci mé diplomové práce je výměnný formát katastru nemovitostí (\zk{VFK}).

V~této kapitole bylo čerpáno především z~oficiální dokumentace (viz \citep{struktura_vfk}). Ukázky formátu pochází z~již zmíněné dokumentace nebo z~veřejně dostupných dat \citep{zdroj_vfk}.

Na~rozdíl od~starého výměnného formátu (\zk{SVF}) obsahuje \zk{VFK} jak soubor popisných informací (\zk{SPI}) - tedy informace o~vlastnících, parcelách, stavbách a~dalších skutečnostech - tak i~soubor geodetických informací (\zk{SGI}) - informace o~polohovém určení.

Soubory \zk{VFK} jsou poskytovány zpracovatelům pozemkových úprav, pozemkovým úřadům, obecním úřadům a~zhotovitelům geometrických plánů. Slouží k~vzájemnému předávání dat mezi~informačním systémem katastru nemovitostí (\zk{ISKN}) a~jinými systémy.

Výměnný formát katastru nemovitostí je tvořen textovým souborem s~koncovkou *.vfk, který má tuto strukturu:
	\begin{itemize}[leftmargin=1.5cm, noitemsep]
		\item \underline{hlavička} - řádky uvozené \texttt{\&H}
		\item \underline{datové bloky} - řádky uvozené \texttt{\&B} a \texttt{\&D}
		\item \underline{koncový znak} - znak \texttt{\&K}
	\end{itemize}

Datový soubor je kódován v češtině dle~ČSN ISO 8859-2 (ISO Latin2), ve~výjimečných případech kódování dle
WIN1250. Oddělovačem desetinných čísel je tečka, datum a~čas je zapsán ve~tvaru "03.06.1999 09:58:42", jednotlivé údaje na~řádku jsou odděleny středníkem, textové a~datumové položky se uvádí v~uvozovkách.

Věty hlavičky (\texttt{\&H}), definice bloku (\texttt{\&B}) a~věty dat (\texttt{\&D}) jsou zakončeny znaky \texttt{<CR><LF>}.

\subsection{Hlavička}
\label{hlavicka}

Každý řádek hlavičky začíná skupinu znaků \texttt{\&H}, za~kterou následuje označení položky a~poté samotné údaje oddělené středníkem. Povinné položky hlavičky s~krátkým popisem jsou uvedené v~tabulce \ref{tab:polozky_hlavicky}.

\begin{table}[H]
\begin{tabular}{|l|l|}
\hline
 položka & popis \\
\hline
\hline
 VERZE & označení verze \zk{VFK} \\ \hline
 VYTVORENO & datum a čas vytvoření souboru \\ \hline
 PUVOD & původ dat \\ \hline
 CODEPAGE & označení kódování \\ \hline
 SKUPINA & seznam datových bloků \\ \hline
 JMENO & jméno autora souboru \\ \hline
 PLATNOST & časová podmínka použitá pro vytvoření souboru \\ \hline
 ZMENY & typ souboru \\ \hline
 KATUZE & omezující podmínka - katastrální území \\ \hline
 OPSUB & omezující podmínka - oprávněné subjekty \\ \hline
 PAR & omezující podmínka - parcely \\ \hline
 POLYG & omezující podmínka - polygon \\
 \hline
\end{tabular}
 \centering
  \caption[Položky hlavičky]{Položky hlavičky (zdroj \citep{struktura_vfk})}
  \label{tab:polozky_hlavicky}
\end{table}

Tabulka \ref{tab:hlavicka_priklady} obsahuje příklady položek hlavičky. Kvůli délce zápisu v~ní nejsou uvedeny příklady pro~omezující podmínky.

\begin{table}[H]
\begin{tabular}{|l|l|}
\hline
 položka & příklad \\
\hline
\hline
 VERZE & \texttt{\&HVERZE;"5.1"} \\ \hline
 VYTVORENO & \texttt{\&HVYTVORENO;"03.12.2013 09:58:42"} \\ \hline
 PUVOD & \texttt{\&HPUVOD;"ISKN"} \\ \hline
 CODEPAGE & \texttt{\&HCODEPAGE;"WE8ISO8859P2"} \\ \hline
 SKUPINA & \texttt{\&HSKUPINA;"NEMO";"JEDN";"BDPA";"VLST"} \\ \hline
 JMENO & \texttt{\&HJMENO;"Kokeš Petr Ing."} \\ \hline
 PLATNOST & \texttt{\&HPLATNOST;"03.12.2013 09:56:42";"03.12.2013 09:56:42"} \\ \hline
 ZMENY & \texttt{\&HZMENY;0} \\
 \hline
\end{tabular}
 \centering
  \caption[Příklady položek hlavičky]{Příklady položek hlavičky (zdroj \citep{struktura_vfk})}
  \label{tab:hlavicka_priklady}
\end{table}

\begin{description}
	\item[VERZE:] Právě jeden řádek obsahující informaci o~verzi \zk{VFK} souboru. Tato informace je důležitá pro programy, které s \zk{VFK} pracují.
	\item[VYTVOŘENO:] Právě jeden řádek s~časem a~datem vytvoření souboru.
	\item[PŮVOD:] Právě jeden řádek specfikující původ dat. Může obsahovat libovolný text.
	\item[CODEPAGE:] Právě jeden řádek označující kódóvání souboru. Možné hodnoty a~odpovídající kódování popisuje tabulka 	\ref{tab:kodovani}.

		\begin{table}[H]
		\begin{tabular}{|l|l|}
		\hline
		 hodnota & popis \\
		\hline
		\hline
		 \texttt{WE8ISO8859P2} & kódování češtiny dle ČSN ISO 8859-2 \\ \hline
		 \texttt{EE8MSWIN1250} & kódování češtiny dle MS WIN1250 \\
		 \hline
		\end{tabular}
		 \centering
		  \caption[Hodnoty kódóvání a jejich popis]{Hodnoty kódóvání a jejich popis (zdroj \citep{struktura_vfk})}
		  \label{tab:kodovani}
		\end{table}

	\item[SKUPINA:] Právě jeden řádek obsahující seznam datových bloků souboru.
	\item[JMÉNO:] Právě jeden řádek se~jménem autora souboru.
	\item[PLATNOST:] Právě jeden řádek s~časovou podmínkou použitou pro~vytvoření souboru. Tabulka \ref{tab:platnost} uvádí dvě možnosti zápisu.

		\begin{table}[H]
		\begin{tabular}{|l|l|}
		\hline
		 příklad & popis \\
		\hline
		\hline
		 \begin{tabular}{@{}l@{}l@{}} \texttt{\&HPLATNOST;} \\ \texttt{"03.12.2013 09:56:42";} \\ \texttt{"03.12.2013 		09:56:42"} \end{tabular} & stav dat k určitému okamžiku \\ \hline
		 \begin{tabular}{@{}l@{}l@{}} \texttt{\&HPLATNOST;} \\ \texttt{"03.12.2012 09:56:42";} \\ \texttt{"03.12.2013 09:56:42"} \end{tabular} & stav dat pro určité období \\
		 \hline
		\end{tabular}
		 \centering
		  \caption[Možnosti zápisu časové podmínky]{Možnosti zápisu časové podmínky (zdroj \citep{struktura_vfk})}
		  \label{tab:platnost}
		\end{table}

	\item[ZMĚNY:] Právě jeden řádek informující o~typu souboru. Možné hodnoty a~jejich popis se nachází v~tabulce \ref{tab:zmeny}.

		\begin{table}[H]
		\begin{tabular}{|l|l|}
		\hline
		 hodnota & popis \\
		\hline
		\hline
		 \texttt{0} & stavový soubor \\ \hline
		 \texttt{1} & změnový soubor \\
		 \hline
		\end{tabular}
		 \centering
		  \caption[Hodnoty typu souborů a~jejich popis]{Hodnoty typu souborů a jejich popis (zdroj \citep{struktura_vfk})}
		  \label{tab:zmeny}
		\end{table}

Stavový soubor obsahuje všechny informace ke~konkrétnímu času a~datu, ve~změnovém souboru se nachází pouze změny za~určitý časový úsek.

	\item[KATUZE, OPSUB, PAR, POLYG:] Soubor \zk{VFK} může být vytvořen pro konkrétní katastrální území, oprávněné subjekty, parcely, nebo~pro~oblast zadanou polygonem. Jedná se o~jeden řádek, který obsahuje hlavičku omezující podmínky a~za~ním následují řádky definující samotnou omezující podmínku. V~případě, že je omezující podmínka prázdná, není za~hlavičkou ani jeden řádek s daty. Příklad pro katastrální území:

\begin{lstlisting}[basicstyle=\footnotesize\ttfamily, backgroundcolor = \color{light-gray},  numbers=left]
&HKATUZE;KOD N6;OBCE_KOD N6;NAZEV T48;PLATNOST_OD D;
PLATNOST_DO D&DKATUZE;693936;550426;"Jama";"19.06.1991 00:00:00";""
 \end{lstlisting}

\end{description}

\subsection{Datové bloky}
\label{datove_bloky}

Každý datový blok obsahuje tyto řádky:

	\begin{itemize}[leftmargin=1.5cm]
		\item \underline{uvozující řádek bloku} - řádek uvozený \texttt{\&B}
		\item \underline{řádky s vlastními daty} - řádky uvozené \texttt{\&D}
	\end{itemize}

\begin{description}	
	\item[Uvozující řádek bloku:] Právě jeden řádek obsahující seznam atributů a~jejich datové typy. V~tabulce \ref{tab:datove_typy} jsou uvedené dostupné datové typy.

		\begin{table}[H]
		\begin{tabular}{|l|l|}
		\hline
		 zkratka & datový typ \\
		\hline
		\hline
		 \texttt{N} & číselný \\ \hline
		 \texttt{T} & textový \\ \hline
		 \texttt{D} & datumový \\
		 \hline
		\end{tabular}
		 \centering
		  \caption[Datové typy]{Datové typy (zdroj \citep{struktura_vfk})}
		  \label{tab:datove_typy}
		\end{table}

Pro~číselné položky označuje číslo za~\texttt{N} maximální délku položky. Pro desetinná čísla udává číslice před~desetinnou tečkou maximální počet číslic, číslice za~desetinnou tečkou definuje počet desetinných míst.

U~textového datového typu číslo za~\texttt{T} značí maximální délku.

Ukázka uvozujícího řádku pro~blok parcela:

	\begin{lstlisting}[basicstyle=\footnotesize\ttfamily, backgroundcolor = \color{light-gray},  numbers=left]
&BPAR;ID N30;STAV_DAT N2;DATUM_VZNIKU D;DATUM_ZANIKU D;
PRIZNAK_KONTEXTU N1;RIZENI_ID_VZNIKU N30;RIZENI_ID_ZANIKU N30;
PKN_ID N30;PAR_TYPE T10;KATUZE_KOD N6;KATUZE_KOD_PUV N6;
DRUH_CISLOVANI_PAR N1;KMENOVE_CISLO_PAR N5;ZDPAZE_KOD N1;
PODDELENI_CISLA_PAR N3;DIL_PARCELY N1;MAPLIS_KOD N30;
ZPURVY_KOD N1;DRUPOZ_KOD N2;ZPVYPA_KOD N4;TYP_PARCELY N1;
VYMERA_PARCELY N9;CENA_NEMOVITOSTI N14.2;DEFINICNI_BOD_PAR T100;
TEL_ID N30;PAR_ID N30;BUD_ID N30;IDENT_BUD T1;SOUCASTI T1;
PS_ID N30;IDENT_PS T1
	\end{lstlisting}

	\item[Řádky s vlastními daty:] Pro~každý objekt jeden řádek.

Ukázka řádku s~vlastními daty pro~objekt parcely.
	
	\begin{lstlisting}[basicstyle=\footnotesize\ttfamily, backgroundcolor = \color{light-gray},  numbers=left]
&DPAR;3067989306;0;"26.06.2003 07:43:05";"";3;3003873306
;;;"PKN";693936;;1;37;;1;;6780;2;13;;;332;;"";674674306;;
323700306;"a";"n";;"n"
	\end{lstlisting}
\end{description}

\subsubsection{Datové bloky důležité pro zásuvný modul}
\label{datove_bloky_zasuvny_modul}

Soubor výměnného formátu katastru nemovitostí obsahuje mnoho datový bloků. Tato sekce se věnuje pouze blokům, které jsou reletvatní pro~zásuvný modul.

V~současné době zásuvný modul pracuje s~těmito datovými bloky\footnote{Zásuvný modul nevyužívá dat \zk{BPEJ} přímo ze~souboru \zk{VFK}, protože hranice \zk{BPEJ} není polohopisným prvkem katastrální mapy. Více o~\zk{BPEJ} viz část \ref{bpej}.}:

	\begin{itemize}[leftmargin=1.5cm]
		\item \zk{PAR} - parcely
		\item \zk{SOBR} - souřadnice obrazu bodů polohopisu v~mapě
		\item \zk{SPOL} - souřadnice polohy bodů polohopisu (měřené)
	\end{itemize}

\begin{description}	
	\item[PAR:] Tabulka \zk{PAR} obsahuje parcely evidované v~\zk{ISKN}. Z~pohledu zásuvného modulu vytvořeného v~rámci této práce se jedná o~nejdůležitější část souboru \zk{VFK}. Je součástí největší skupiny datových bloků nemovitosti. V~tabulce \ref{tab:par_sloupce} jsou uvedeny sloupce, kterých využívá zásuvný modul.
	
		\begin{table}[H]
		\begin{tabular}{|l|l|l|l|l|}
		\hline
		 název & povinný & typ & velikost & popis\\
		\hline
		\hline
		ID & ano & N & 30.0 & \begin{tabular}{@{}l@{}} unikátní generované \\ číslo parcely \end{tabular} \\ \hline
		KMENOVE\_CISLO\_PAR & ano & N & 5 & kmenové parcelní číslo \\ \hline
		PODDELENI\_CISLA\_PAR & ne & N & 3 & poddělení čísla parcely \\ \hline
		DRUPOZ\_KOD & ne & N & 2.0 & kód druhu pozemku. \\ \hline
		VYMERA\_PARCELY & ano & N & 9.0 & \begin{tabular}{@{}l@{}} výměra parcely \\ v metrech čtverečních \end{tabular} \\
		 \hline
		\end{tabular}
		 \centering
		  \caption[Sloupce datového bloku \zk{PAR}]{Sloupce datového bloku \zk{PAR} (zdroj \citep{struktura_vfk})}
		  \label{tab:par_sloupce}
		\end{table}
		
	\item[SOBR, SPOL:] Tabulka \zk{SOBR} obsahuje body polohopisu (čísla bodů a~souřadnice obrazu v~mapě). V~tabulce \zk{SPOL} jsou uvedeny body polohopisu (čísla bodů a~souřadnice polohy). Obě tabulky jsou součástí skupiny datových bloků prvky katastrální mapy. Zásuvný modul používá pouze jeden sloupec z~těchto datových bloků (viz~\ref{tab:sobr_spol_sloupce}).
	
		\begin{table}[H]
		\begin{tabular}{|l|l|l|l|l|}
		\hline
		 název & povinný & typ & velikost & popis\\
		\hline
		\hline
		KODCHB\_KOD & ne & N & 2.0 & \begin{tabular}{@{}l@{}} kód charakteristiky \\ kvality bodu \end{tabular} \\
		 \hline
		\end{tabular}
		 \centering
		  \caption[Sloupce datových bloků \zk{SOBR} a \zk{SPOL}]{Sloupce datových bloků \zk{SOBR} a \zk{SPOL} (zdroj \citep{struktura_vfk})}
		  \label{tab:sobr_spol_sloupce}
		\end{table}	
	
\end{description}

\subsection{Koncový znak}
\label{koncovy_znak}

Znak \texttt{\&K} signalizuje konec souboru \zk{VFK}. Pro~software, který načítá \zk{VFK}, to znamená pokyn pro~ukončení importu.

\section{BPEJ}
\label{bpej}